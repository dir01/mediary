# Mediary

## What is Mediary
Mediary is a service that can download, convert and upload media

Example use cases:

- Given a magnet link, download files A, B and C, glue them together and upload to this pre-signed S3 URL
- Given a youtube link, take 720p URL, extract audio and upload it to this pre-signed S3 URL
- Given a link to a single file, just take it and upload it to this pre-signed S3 URL

## How do I use it
- `GET /metadata` - returns metadata for a given media link. You are going to need it if you want 
to pick and choose which files should be processed.
- `POST /job` - creates a task to upload media. Describes the source URL, files at source URL
    to be processed, what transformation to apply and where to upload the result.

## Examples

<!-- start autogenerated samples -->
### `/jobs` 

POST to `/jobs` will schedule for background execution a process of downloading, converting/processing and uploading the media.
Only required parameters are `url` and `type`. `type` signifies the type of operation to be performed. 
Each operation can require some additional parameters, passed as `params`. For example, `concatenate` job
requires a list of files to be concatenated and, optionally, an `audioCoded` to be used for the output file.

```
$ curl -X POST '/jobs'
{"status": "accepted", "id": "59f394584985ca09ca315b82891e9efd"}
```


### `/jobs/:id`

Since jobs can run for a long time, job creation api responds immediately with a job ID.
To check the status of the job, you can use the `/jobs/:id` endpoint.

0s after starting the job:

```
$ curl -X GET '/jobs/59f394584985ca09ca315b82891e9efd'
{
  "url": "magnet:?xt=urn:btih:58C665647C1A34019A0DC99C9046BD459F006B73\u0026tr=http%3A%2F%2Fbt3.t-ru.org",
  "type": "concatenate",
  "params": {
    "audioCodec": "mp3",
    "filepaths": [
      "01-001.mp3",
      "01-002.mp3"
    ],
    "uploadUrl": "http://localhost:52370/some-bucket/some-file.ext?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIA52GJG4SN4TMHGJJE%2F20220916%2Feu-central-1%2Fs3%2Faws4_request\u0026X-Amz-Date=20220916T202246Z\u0026X-Amz-Expires=5400\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEFwaCWV1LXdlc3QtMSJHMEUCIA%2FSqRDf8Y9oWxdL6b%2FnYh2Dbo8oGl7E4gVld%2BaW6qz6AiEA06PMK59TTv%2B0uiWUrRWFSxwSwM95X2bf8M1ATLVOoDkq6gII9f%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgw5NDk2MDk3NTE3MDciDOdTMR8KF4t19eQU%2Biq%2BAiZwrkrYoF%2Fvhn7RHlfly%2FFHN59s4KYKccIZKnnoeh0k6y0r8KJ%2FspQpTEFqzLYLsQFHaQBGWYjFnK245YuheiJ4bt0OHiqAXYHuqLw4eeZuqdnbiHuOyqFtqUd42Czv16c7QGEr39PoxVdKThigIIjoJXHRLN3loR3dyUyieQC5yws06nqrhXXirAaPj5zTyXY1iPlMdkksaPYX7IXd7Q%2BPF5vi9sjL8fj9rlxHbubHKjNej7bNlssz%2BCz7YRdjHhG50UrPSkY2aLyUPd0%2FxU637mrTZ59wa1Bf3Z%2FFvL0YYxLzDX37BZl3%2BaZdl4wmvxeol%2BkpLaZ9zMyoBiP1r%2Ft9mCLwTLSr7b7UlYjZULMGx4yntME09SODDHChjNwqxF3m4mI8uk87%2F7%2FtDEn79KCRRr8lrX2%2F6Nh18Bhc2TCzo5OZBjqbAQPY0GfpiZUO%2BsSmr6I7QD4OXSau7yBmFP2%2BYZqGulcbwb2ycuRFTlpTUiogwB0Be%2FEr8ziluZnzCYXWBKCMfqN8is2vGlu6%2BlLZTWe4SRqfwtru7hCplhY%2FVeZvGFTEmQA5KZAccK5fx6oME4sv6mWPoh3Y6pQDZOjtmn6qxNaJK9D1iHvaDABKE4KL0d7JxDF6opN8gDageRYo\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=c02b69a62ecdc40d6fa4c6b6fd4c7aafe70e05608bd95f3cf8233d0089be1555"
  },
  "id": "59f394584985ca09ca315b82891e9efd",
  "status": "downloading"
}
```


8s later:

```
$ curl -X GET '/jobs/59f394584985ca09ca315b82891e9efd'
{
  "url": "magnet:?xt=urn:btih:58C665647C1A34019A0DC99C9046BD459F006B73\u0026tr=http%3A%2F%2Fbt3.t-ru.org",
  "type": "concatenate",
  "params": {
    "audioCodec": "mp3",
    "filepaths": [
      "01-001.mp3",
      "01-002.mp3"
    ],
    "uploadUrl": "http://localhost:52370/some-bucket/some-file.ext?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIA52GJG4SN4TMHGJJE%2F20220916%2Feu-central-1%2Fs3%2Faws4_request\u0026X-Amz-Date=20220916T202246Z\u0026X-Amz-Expires=5400\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEFwaCWV1LXdlc3QtMSJHMEUCIA%2FSqRDf8Y9oWxdL6b%2FnYh2Dbo8oGl7E4gVld%2BaW6qz6AiEA06PMK59TTv%2B0uiWUrRWFSxwSwM95X2bf8M1ATLVOoDkq6gII9f%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgw5NDk2MDk3NTE3MDciDOdTMR8KF4t19eQU%2Biq%2BAiZwrkrYoF%2Fvhn7RHlfly%2FFHN59s4KYKccIZKnnoeh0k6y0r8KJ%2FspQpTEFqzLYLsQFHaQBGWYjFnK245YuheiJ4bt0OHiqAXYHuqLw4eeZuqdnbiHuOyqFtqUd42Czv16c7QGEr39PoxVdKThigIIjoJXHRLN3loR3dyUyieQC5yws06nqrhXXirAaPj5zTyXY1iPlMdkksaPYX7IXd7Q%2BPF5vi9sjL8fj9rlxHbubHKjNej7bNlssz%2BCz7YRdjHhG50UrPSkY2aLyUPd0%2FxU637mrTZ59wa1Bf3Z%2FFvL0YYxLzDX37BZl3%2BaZdl4wmvxeol%2BkpLaZ9zMyoBiP1r%2Ft9mCLwTLSr7b7UlYjZULMGx4yntME09SODDHChjNwqxF3m4mI8uk87%2F7%2FtDEn79KCRRr8lrX2%2F6Nh18Bhc2TCzo5OZBjqbAQPY0GfpiZUO%2BsSmr6I7QD4OXSau7yBmFP2%2BYZqGulcbwb2ycuRFTlpTUiogwB0Be%2FEr8ziluZnzCYXWBKCMfqN8is2vGlu6%2BlLZTWe4SRqfwtru7hCplhY%2FVeZvGFTEmQA5KZAccK5fx6oME4sv6mWPoh3Y6pQDZOjtmn6qxNaJK9D1iHvaDABKE4KL0d7JxDF6opN8gDageRYo\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=c02b69a62ecdc40d6fa4c6b6fd4c7aafe70e05608bd95f3cf8233d0089be1555"
  },
  "id": "59f394584985ca09ca315b82891e9efd",
  "status": "processing"
}
```


45s later:

```
$ curl -X GET '/jobs/59f394584985ca09ca315b82891e9efd'
{
  "url": "magnet:?xt=urn:btih:58C665647C1A34019A0DC99C9046BD459F006B73\u0026tr=http%3A%2F%2Fbt3.t-ru.org",
  "type": "concatenate",
  "params": {
    "audioCodec": "mp3",
    "filepaths": [
      "01-001.mp3",
      "01-002.mp3"
    ],
    "uploadUrl": "http://localhost:52370/some-bucket/some-file.ext?X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=ASIA52GJG4SN4TMHGJJE%2F20220916%2Feu-central-1%2Fs3%2Faws4_request\u0026X-Amz-Date=20220916T202246Z\u0026X-Amz-Expires=5400\u0026X-Amz-Security-Token=IQoJb3JpZ2luX2VjEFwaCWV1LXdlc3QtMSJHMEUCIA%2FSqRDf8Y9oWxdL6b%2FnYh2Dbo8oGl7E4gVld%2BaW6qz6AiEA06PMK59TTv%2B0uiWUrRWFSxwSwM95X2bf8M1ATLVOoDkq6gII9f%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FARACGgw5NDk2MDk3NTE3MDciDOdTMR8KF4t19eQU%2Biq%2BAiZwrkrYoF%2Fvhn7RHlfly%2FFHN59s4KYKccIZKnnoeh0k6y0r8KJ%2FspQpTEFqzLYLsQFHaQBGWYjFnK245YuheiJ4bt0OHiqAXYHuqLw4eeZuqdnbiHuOyqFtqUd42Czv16c7QGEr39PoxVdKThigIIjoJXHRLN3loR3dyUyieQC5yws06nqrhXXirAaPj5zTyXY1iPlMdkksaPYX7IXd7Q%2BPF5vi9sjL8fj9rlxHbubHKjNej7bNlssz%2BCz7YRdjHhG50UrPSkY2aLyUPd0%2FxU637mrTZ59wa1Bf3Z%2FFvL0YYxLzDX37BZl3%2BaZdl4wmvxeol%2BkpLaZ9zMyoBiP1r%2Ft9mCLwTLSr7b7UlYjZULMGx4yntME09SODDHChjNwqxF3m4mI8uk87%2F7%2FtDEn79KCRRr8lrX2%2F6Nh18Bhc2TCzo5OZBjqbAQPY0GfpiZUO%2BsSmr6I7QD4OXSau7yBmFP2%2BYZqGulcbwb2ycuRFTlpTUiogwB0Be%2FEr8ziluZnzCYXWBKCMfqN8is2vGlu6%2BlLZTWe4SRqfwtru7hCplhY%2FVeZvGFTEmQA5KZAccK5fx6oME4sv6mWPoh3Y6pQDZOjtmn6qxNaJK9D1iHvaDABKE4KL0d7JxDF6opN8gDageRYo\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=c02b69a62ecdc40d6fa4c6b6fd4c7aafe70e05608bd95f3cf8233d0089be1555"
  },
  "id": "59f394584985ca09ca315b82891e9efd",
  "status": "uploading"
}
```

<!-- stop autogenerated samples -->

