# Mediary

## What is Mediary
Mediary is a service that can download, convert and upload media

Example use cases:

- Given a magnet link, download files A, B and C, glue them together and upload to this pre-signed S3 URL
- Given a youtube link, take 720p URL, extract audio and upload it to this pre-signed S3 URL
- Given a link to a single file, just take it and upload it to this pre-signed S3 URL

## How do I use it
- `POST /upload` - creates a task to upload media. Describes the source URL, files at source URL 
to be processed, what transformation to apply and where to upload the result.
- `GET /metadata` - returns metadata for a given media link. You are going to need it if you want 
to pick and choose which files should be processed.
- `GET /upload/{taskId}` - returns status of a given task.

## Examples

<!-- start autogenerated samples -->
### /metadata - Timeouts

By default, the endpoint will timeout pretty quickly, 
probably sooner than it takes to fetch metadata of a torrent, for example.

In such cases, the endpoint will return a 202 Accepted status code and a message "{"foo": "bar"}"

Feel free to repeat your request later: metadata is still being fetched in background.

```
$ curl -X GET '/metadata?url=magnet:?xt=urn:btih:1EAA77FA58C40D5499914AE740EC7F906EF10D65'
{"foo": "bar"}
```


### /metadata/long-polling

In case you'd rather wait for the metadata to be fetched, you can use the long-polling endpoint.

It will not return a response until the metadata is fetched.

There is still a timeout on the request, but it's pretty long (5 minutes).
```
$ curl -X GET '/metadata/long-polling?url=magnet:?xt=urn:btih:1EAA77FA58C40D5499914AE740EC7F906EF10D65'
{
  "url": "magnet:?xt=urn:btih:1EAA77FA58C40D5499914AE740EC7F906EF10D65",
  "name": "John Coltrane - A Love Supreme (1965) (Acoustic Sounds Series) (PBTHAL LP 24-96) [FLAC] vtwin88cube",
  "files": [
    {
      "path": "00.-John Coltrane - A Love Supreme.m3u",
      "length_bytes": 111
    },
    {
      "path": "01.-Part 1 - Acknowledgement.flac",
      "length_bytes": 170093783
    },
    {
      "path": "02.-Part 2 - Resolution.flac",
      "length_bytes": 165357192
    },
    {
      "path": "03.-Part 3 - Pursuance \u0026 Part 4 - Psalm.flac",
      "length_bytes": 386514548
    },
    {
      "path": "DR13.txt",
      "length_bytes": 979
    },
    {
      "path": "folder.jpg",
      "length_bytes": 187670
    },
    {
      "path": "lineage.txt",
      "length_bytes": 556
    }
  ]
}
```


### /metadata - Cached

It goes without saying, that once the metadata is fetched, it is cached.

So all consequitive requests for the same URL will return the same metadata, and immediately.
```
$ curl -X GET '/metadata?url=magnet:?xt=urn:btih:1EAA77FA58C40D5499914AE740EC7F906EF10D65'
{
  "url": "magnet:?xt=urn:btih:1EAA77FA58C40D5499914AE740EC7F906EF10D65",
  "name": "John Coltrane - A Love Supreme (1965) (Acoustic Sounds Series) (PBTHAL LP 24-96) [FLAC] vtwin88cube",
  "files": [
    {
      "path": "00.-John Coltrane - A Love Supreme.m3u",
      "length_bytes": 111
    },
    {
      "path": "01.-Part 1 - Acknowledgement.flac",
      "length_bytes": 170093783
    },
    {
      "path": "02.-Part 2 - Resolution.flac",
      "length_bytes": 165357192
    },
    {
      "path": "03.-Part 3 - Pursuance \u0026 Part 4 - Psalm.flac",
      "length_bytes": 386514548
    },
    {
      "path": "DR13.txt",
      "length_bytes": 979
    },
    {
      "path": "folder.jpg",
      "length_bytes": 187670
    },
    {
      "path": "lineage.txt",
      "length_bytes": 556
    }
  ]
}
```

<!-- stop autogenerated samples -->

